<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <title>AES-256 終極加密工廠 - 專業版</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/crypto-js/4.1.1/crypto-js.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jszip/3.10.1/jszip.min.js"></script>
    <style>
        :root { --primary: #3498db; --bg: #0d1117; --card: #161b22; --border: #30363d; }
        body { background: var(--bg); color: #c9d1d9; font-family: -apple-system, sans-serif; display: flex; justify-content: center; padding: 40px; margin: 0; }
        .factory-card { background: var(--card); padding: 40px; border-radius: 12px; width: 100%; max-width: 600px; border: 1px solid var(--border); box-shadow: 0 10px 30px rgba(0,0,0,0.5); }
        h1 { font-weight: 500; color: var(--primary); margin-top: 0; border-bottom: 1px solid var(--border); padding-bottom: 15px; text-align: center; }
        .step { margin-top: 25px; }
        label { display: block; margin-bottom: 10px; color: #8b949e; font-size: 0.95rem; font-weight: bold; }
        input[type="text"] { width: 100%; background: #010409; border: 1px solid var(--border); border-radius: 6px; color: #f0f6fc; padding: 12px; box-sizing: border-box; font-size: 1rem; }
        .drop-zone { border: 2px dashed var(--border); border-radius: 8px; padding: 40px; text-align: center; color: #555; cursor: pointer; transition: 0.3s; background: rgba(255,255,255,0.02); margin-top: 10px; }
        .drop-zone.dragover { border-color: var(--primary); background: rgba(52, 152, 219, 0.1); color: #3498db; }
        button { background: var(--primary); color: white; border: none; padding: 18px; width: 100%; border-radius: 6px; font-size: 1.1rem; font-weight: 600; cursor: pointer; margin-top: 35px; transition: 0.2s; }
        button:hover { background: #2980b9; transform: translateY(-1px); }
        #status { margin-top: 20px; text-align: center; color: #2ecc71; font-weight: bold; display: none; }
    </style>
</head>
<body>

<div class="factory-card">
    <h1>網頁加密打包工廠 (ZIP版)</h1>
    
    <div class="step">
        <label>STEP 1. 設定固定存取密碼 (Digital Key)</label>
        <input type="text" id="m_pass" placeholder="例如: yusyu888">
    </div>

    <div class="step">
        <label>STEP 2. 匯入指定的網頁檔案 (HTML)</label>
        <div class="drop-zone" id="drop_zone" onclick="document.getElementById('m_file').click()">
            <span id="file_label">點擊選取 或 拖曳 HTML 檔案至此</span>
            <input type="file" id="m_file" accept=".html,.htm" style="display:none">
        </div>
    </div>

    <button onclick="processFiles()">立刻加密並打包下載</button>

    <div id="status">✅ 處理完成！ZIP 壓縮包已下載。</div>
</div>

<script>
const dropZone = document.getElementById('drop_zone');
const fileInput = document.getElementById('m_file');
const fileLabel = document.getElementById('file_label');

function updateLabel(name) {
    fileLabel.innerText = "已選取: " + name;
    fileLabel.style.color = "#3498db";
}

fileInput.onchange = function() {
    if (this.files.length > 0) updateLabel(this.files[0].name);
};

// 拖曳事件處理
dropZone.addEventListener('dragover', (e) => { 
    e.preventDefault(); e.stopPropagation(); 
    dropZone.classList.add('dragover'); 
});
dropZone.addEventListener('dragleave', (e) => { 
    e.preventDefault(); e.stopPropagation(); 
    dropZone.classList.remove('dragover'); 
});
dropZone.addEventListener('drop', (e) => {
    e.preventDefault(); e.stopPropagation();
    dropZone.classList.remove('dragover');
    const files = e.dataTransfer.files;
    if (files.length > 0) {
        fileInput.files = files;
        updateLabel(files[0].name);
    }
});

async function processFiles() {
    const pw = document.getElementById('m_pass').value;
    const file = fileInput.files[0];
    
    if(!pw || !file) return alert("請確認已輸入密碼並匯入網頁檔案！");

    const reader = new FileReader();
    reader.onload = async function(e) {
        const rawContent = e.target.result;
        
        // 1. 計算雜湊檔名
        const encoder = new TextEncoder();
        const data = encoder.encode(pw);
        const hashBuffer = await crypto.subtle.digest('SHA-256', data);
        const hashedFileName = Array.from(new Uint8Array(hashBuffer)).map(b => b.toString(16).padStart(2, '0')).join('');

        // 2. 加密內容
        const encrypted = CryptoJS.AES.encrypt(rawContent, pw).toString();

        // 3. 產生 index.html 模板
        const indexHTML = `<!DOCTYPE html><html><head><meta charset="UTF-8"><meta name="viewport" content="width=device-width,initial-scale=1.0"><title>SECURE ACCESS</title><style>body{background:#000;display:flex;align-items:center;justify-content:center;height:100vh;margin:0;color:#fff;font-family:sans-serif}.box{text-align:center;width:450px;position:relative}.title{font-size:28px;color:#888;letter-spacing:4px;margin-bottom:5px;font-weight:300}input{background:transparent;border:none;border-bottom:2px solid #3498db;color:#fff;font-size:1.5rem;text-align:center;outline:none;padding:10px;width:100%;letter-spacing:8px}.side{position:absolute;left:-140px;bottom:12px;font-size:16px;color:#444;letter-spacing:2px}.footer{margin-top:15px;font-size:14px;color:#444;letter-spacing:3px;font-weight:700}</style></head><body><div class="box"><div class="side"></div><div class="title">DIGITAL KEY</div><input type="password" id="k" autofocus onkeyup="if(event.keyCode==13)go()"><div class="footer">ENCRYPTED BY AES-256</div></div><script>async function go(){const v=document.getElementById('k').value;const d=new TextEncoder().encode(v);const b=await crypto.subtle.digest('SHA-256',d);const h=Array.from(new Uint8Array(b)).map(x=>x.toString(16).padStart(2,'0')).join('');window.location.href=h+".html#"+encodeURIComponent(v)}<\/script></body></html>`;

        // 4. 產生加密內容頁模板
        const mainHTML = `<!DOCTYPE html><html><head><meta charset="UTF-8"><script src="https://cdnjs.cloudflare.com/ajax/libs/crypto-js/4.1.1/crypto-js.min.js"><\/script><style>body{background:#000;display:flex;align-items:center;justify-content:center;height:100vh;margin:0;color:#fff;font-family:sans-serif}.box{text-align:center;width:450px;position:relative}.title{font-size:28px;color:#888;letter-spacing:4px;margin-bottom:5px;font-weight:300}.line{border-bottom:2px solid #3498db;width:100%;height:40px;margin-bottom:10px}.side{position:absolute;left:-140px;bottom:12px;font-size:16px;color:#444;letter-spacing:2px}.footer{margin-top:15px;font-size:14px;color:#444;letter-spacing:3px;font-weight:700}.ovl{position:absolute;left:-140px;bottom:12px;color:#fff;font-size:18px;letter-spacing:2px;z-index:10;font-weight:700}</style></head><body><div class="box"><div class="ovl"></div><div class="side"></div><div class="title">DIGITAL KEY</div><div class="line"></div><div class="footer">ENCRYPTED BY AES-256</div></div><script>(function(){const p=decodeURIComponent(window.location.hash.substring(1));if(!p){window.location.href="index.html";return}setTimeout(()=>{try{const d=CryptoJS.AES.decrypt("${encrypted}",p).toString(CryptoJS.enc.Utf8);if(!d)throw new Error();history.replaceState(null,null,window.location.pathname);document.open();document.write(d);document.close()}catch(e){alert("ACCESS DENIED");window.location.href="index.html"}},800)})()<\/script></body></html>`;

        // 5. 使用 JSZip 打包並下載
        const zip = new JSZip();
        zip.file("index.html", indexHTML);
        zip.file(hashedFileName + ".html", mainHTML);

        zip.generateAsync({type:"blob"}).then(function(content) {
            const link = document.createElement("a");
            link.href = URL.createObjectURL(content);
            link.download = "encrypted_output.zip";
            link.click();
            document.getElementById('status').style.display = 'block';
        });
    };
    reader.readAsText(file);
}
</script>
</body>
</html>